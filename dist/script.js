(()=>{"use strict";var t=function(t,e){this.x=t,this.y=e,this.element=!1,this.containsObject=!1},e=function(){function e(t,e){this.width=t,this.height=e,this.grid=this.createGrid()}return e.prototype.createGrid=function(){var e,i,n=new Array(this.height);for(e=0;e<this.height;e++){var s=new Array(this.width);for(i=0;i<this.width;i++)s[i]=new t(i,e);n[e]=s}return n},e}(),i=function(t,e,i){this.grid=t,this.currentX=e-1,this.currentY=i-1,this.currentCell=t.grid[i-1][e-1],this.homeCell=t.grid[i-1][e-1],this.element=!1},n=function(){function t(t,e,i,n,s){void 0===i&&(i=!1),this.timePlay=t,this.canPlay=!1,this.stopFunction=i,this.person=e,this.view=n,this.model=s,this.count=0,this.isCollected=!1,this.continueGame=!1}return t.prototype.startGame=function(){var t,e=this;this.canPlay=!0,setTimeout((function(){e.stopGame(e)}),this.timePlay);var i=this.timePlay/100,n=null===(t=document.querySelector("#progress"))||void 0===t?void 0:t.querySelector("progress"),s=setInterval((function(){i--,n.setAttribute("value",""+i),i<=0&&(console.log("stop timer"),clearInterval(s))}),100)},t.prototype.stopGame=function(t){t.canPlay=!1,t.stopFunction&&t.stopFunction()},t}(),s=function(){function t(){}return t.prototype.start=function(t,e,i,n){this.drawGrid(t),e.element=document.getElementById("person"),e.currentCell.element.appendChild(document.getElementById("home")),this.setPositionPerson(e,e.currentCell),this.drawProgressBar(i.timePlay),this.drawObjects(n),i.startGame()},t.prototype.viewMessage=function(){document.querySelector(".message").style.visibility="visible"},t.prototype.hideMessage=function(){document.querySelector(".message").style.visibility="hidden"},t.prototype.drawObjects=function(t){t.forEach((function(t){var e=document.createElement("div");e.classList.add("carrot"),t.element.appendChild(e)}))},t.prototype.cleaningCell=function(t){t.forEach((function(t){t.element.innerHTML=""}))},t.prototype.continueGame=function(t,e,i){this.setPositionPerson(t,t.homeCell),this.drawObjects(i),e.startGame(),console.log("continue")},t.prototype.setPositionPerson=function(t,e){e.containsObject&&(e.element.innerHTML=""),e.element.appendChild(t.element),t.currentX=e.x,t.currentY=e.y,t.currentCell=e},t.prototype.refreshCount=function(t){document.getElementById("counter").innerHTML=""+t},t.prototype.drawProgressBar=function(t){var e=document.getElementById("progress"),i=document.createElement("progress");i.setAttribute("max",""+t/100),i.setAttribute("value","0"),e.appendChild(i)},t.prototype.drawGrid=function(t){var e,i,n=document.getElementById("grid");for(e=0;e<t.height;e++){var s=document.createElement("div");for(s.classList.add("row"),i=0;i<t.width;i++){var o=document.createElement("div");o.classList.add("cell"),t.grid[e][i].element=o,t.grid[e][i].htmlX=o.style.left+"px",t.grid[e][i].htmlY=o.style.top+"px",null==s||s.appendChild(o)}null==n||n.appendChild(s)}},t}(),o=function(){function t(t,s,o,r){this.view=t,this.grid=new e(s,o),this.person=new i(this.grid,3,5),this.game=new n(1e3*r/2,this.person,this.stopGame,this.view,this),this.count=0,this.lastRoundCount=0,this.isCollected=!1,this.continueGame=!1}return t.prototype.start=function(){this.objects=this.calculatePositionObjects(),this.view.start(this.grid,this.person,this.game,this.objects)},t.prototype.stopGame=function(){console.log("stop game"),this.person.currentCell!=this.person.homeCell||0==this.isCollected?(console.log("lose"),this.continueGame=!1,this.count=0,this.view.refreshCount(this.count)):(this.continueGame=!0,console.log("cool")),this.view.viewMessage()},t.prototype.calculatePositionObjects=function(){var t,e=this.randomInt(2,5),i=new Array(e);for(t=0;t<e;t++){var n=this.randomInt(0,this.grid.height-1),s=this.randomInt(0,this.grid.width-1);this.person.homeCell!=this.grid.grid[n][s]?(this.grid.grid[n][s].containsObject=!0,i[t]=this.grid.grid[n][s]):t--}return i},t.prototype.randomInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},t.prototype.checkContains=function(t){if(t.containsObject){this.game.isCollected=!0,this.count+=1,this.view.refreshCount(this.count),t.containsObject=!1;var e=void 0;for(e=0;e<this.objects.length&&t!=this.objects[e];e++);}},t.prototype.cleaningCell=function(){this.objects.forEach((function(t){t.containsObject=!1}))},t.prototype.definitionKey=function(t){if(this.game.canPlay)switch(t){case"KeyW":if(this.person.currentY-1>=0){var e=this.grid.grid[this.person.currentY-1][this.person.currentX];this.view.setPositionPerson(this.person,e),this.checkContains(e)}break;case"KeyS":this.person.currentY+1<=this.grid.height-1&&(e=this.grid.grid[this.person.currentY+1][this.person.currentX],this.view.setPositionPerson(this.person,e),this.checkContains(e));break;case"KeyA":this.person.currentX-1>=0&&(e=this.grid.grid[this.person.currentY][this.person.currentX-1],this.view.setPositionPerson(this.person,e),this.checkContains(e));break;case"KeyD":this.person.currentX+1<=this.grid.width-1&&(e=this.grid.grid[this.person.currentY][this.person.currentX+1],this.view.setPositionPerson(this.person,e),this.checkContains(e))}else"Enter"==t&&(this.view.hideMessage(),this.game.isCollected=!1,this.game.continueGame||(this.count=0),this.objects.length>0&&(this.cleaningCell(),this.view.cleaningCell(this.objects)),this.objects=this.calculatePositionObjects(),this.view.continueGame(this.person,this.game,this.objects))},t}(),r=function(){function t(t){this.model=t}return t.prototype.start=function(){this.model.start(),this.auditionEvent()},t.prototype.auditionEvent=function(){var t=this;document.onkeydown=function(e){t.model.definitionKey(e.code)}},t}(),c=document.querySelector("#start-message");c.style.visibility="visible";var h=document.querySelector(".main");h.style.visibility="hidden",document.onkeydown=function(t){if("Enter"==t.code){for(var e=prompt("Введите ширину поля >= 5","");Number(e)<5;)e=prompt("Введите ширину поля >= 5","");for(var i=prompt("Введите высоту поля >= 5","");Number(i)<5;)i=prompt("Введите высоту поля >= 5","");for(var n=prompt("Введите время раунда >= 5 секунд","");Number(n)<5;)n=prompt("Введите время раунда >= 5","");h.style.visibility="visible";var a=new s,l=new o(a,Number(e),Number(i),Number(n));new r(l).start(),c.style.visibility="hidden"}}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90c193ZWJwYWNrLy4vc3JjL2luZGV4LnRzIl0sIm5hbWVzIjpbIngiLCJ5IiwidGhpcyIsImVsZW1lbnQiLCJjb250YWluc09iamVjdCIsIndpZHRoIiwiaGVpZ2h0IiwiZ3JpZCIsImNyZWF0ZUdyaWQiLCJpIiwiaiIsIkFycmF5Iiwicm93IiwiQ2VsbCIsInN0YXJ0WCIsInN0YXJ0WSIsImN1cnJlbnRYIiwiY3VycmVudFkiLCJjdXJyZW50Q2VsbCIsImhvbWVDZWxsIiwidGltZVBsYXkiLCJwZXJzb24iLCJzdG9wRnVuY3Rpb24iLCJ2aWV3IiwibW9kZWwiLCJjYW5QbGF5IiwiY291bnQiLCJpc0NvbGxlY3RlZCIsImNvbnRpbnVlR2FtZSIsInN0YXJ0R2FtZSIsInRoYXQiLCJzZXRUaW1lb3V0Iiwic3RvcEdhbWUiLCJjb3VudGVyIiwicHJvZ3Jlc3NCYXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ0aW1lciIsInNldEludGVydmFsIiwic2V0QXR0cmlidXRlIiwiY29uc29sZSIsImxvZyIsImNsZWFySW50ZXJ2YWwiLCJzdGFydCIsImdhbWUiLCJvYmplY3RzIiwiZHJhd0dyaWQiLCJnZXRFbGVtZW50QnlJZCIsImFwcGVuZENoaWxkIiwic2V0UG9zaXRpb25QZXJzb24iLCJkcmF3UHJvZ3Jlc3NCYXIiLCJkcmF3T2JqZWN0cyIsInZpZXdNZXNzYWdlIiwic3R5bGUiLCJ2aXNpYmlsaXR5IiwiaGlkZU1lc3NhZ2UiLCJmb3JFYWNoIiwib2JqZWN0IiwiY2Fycm90IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsImNsZWFuaW5nQ2VsbCIsImlubmVySFRNTCIsImNlbGwiLCJyZWZyZXNoQ291bnQiLCJwcm9ncmVzc0JhckNvbnRhaW5lciIsImdyaWRDb250YWluZXIiLCJkaXYiLCJodG1sWCIsImxlZnQiLCJodG1sWSIsInRvcCIsInRpbWVSb3VuZCIsIkdyaWQiLCJQZXJzb24iLCJHYW1lIiwibGFzdFJvdW5kQ291bnQiLCJjYWxjdWxhdGVQb3NpdGlvbk9iamVjdHMiLCJyYW5kb21Db3VudCIsInJhbmRvbUludCIsIm1pbiIsIm1heCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImNoZWNrQ29udGFpbnMiLCJsZW5ndGgiLCJkZWZpbml0aW9uS2V5IiwiY29kZSIsImF1ZGl0aW9uRXZlbnQiLCJvbmtleWRvd24iLCJldmVudCIsIm1lc3NhZ2VFbGVtZW50IiwibWFpbkVsZW1lbnQiLCJwcm9tcHQiLCJOdW1iZXIiLCJWaWV3IiwiTW9kZWwiLCJDb250cm9sbGVyIl0sIm1hcHBpbmdzIjoibUJBQUEsTUFPSSxTQUFZQSxFQUFXQyxHQUVuQkMsS0FBS0YsRUFBSUEsRUFDVEUsS0FBS0QsRUFBSUEsRUFDVEMsS0FBS0MsU0FBVSxFQUNmRCxLQUFLRSxnQkFBaUIsR0FJOUIsYUFNSSxXQUFZQyxFQUFlQyxHQUV2QkosS0FBS0csTUFBUUEsRUFDYkgsS0FBS0ksT0FBU0EsRUFDZEosS0FBS0ssS0FBT0wsS0FBS00sYUFvQnpCLE9BakJJLFlBQUFBLFdBQUEsV0FFSSxJQUFJQyxFQUNBQyxFQUNBSCxFQUFPLElBQUlJLE1BQU1ULEtBQUtJLFFBQzFCLElBQUtHLEVBQUksRUFBR0EsRUFBSVAsS0FBS0ksT0FBUUcsSUFDN0IsQ0FDSSxJQUFJRyxFQUFjLElBQUlELE1BQU1ULEtBQUtHLE9BQ2pDLElBQUtLLEVBQUksRUFBR0EsRUFBSVIsS0FBS0csTUFBT0ssSUFFeEJFLEVBQUlGLEdBQUssSUFBSUcsRUFBS0gsRUFBR0QsR0FFekJGLEVBQUtFLEdBQUtHLEVBR2QsT0FBT0wsR0FFZixFQTlCQSxHQWdDQSxFQVNJLFNBQVlBLEVBQVdPLEVBQWdCQyxHQUVuQ2IsS0FBS0ssS0FBT0EsRUFDWkwsS0FBS2MsU0FBV0YsRUFBUyxFQUN6QlosS0FBS2UsU0FBV0YsRUFBUyxFQUN6QmIsS0FBS2dCLFlBQWNYLEVBQUtBLEtBQUtRLEVBQU8sR0FBR0QsRUFBTyxHQUM5Q1osS0FBS2lCLFNBQVdaLEVBQUtBLEtBQUtRLEVB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QU8sNEJBQTZCLElBRXBERCxFQUFZekMsTUFBTUMsV0FBYSxVQUMvQixJQUFNL0IsRUFBYSxJQUFJMEUsRUFDakJ6RSxFQUFlLElBQUkwRSxFQUFNM0UsRUFBTXlFLE9BQU8zRixHQUFRMkYsT0FBTzFGLEdBQVMwRixPQUFPdkIsSUFDNUMsSUFBSTBCLEVBQVczRSxHQUNuQ21CLFFBQ1hrRCxFQUFleEMsTUFBTUMsV0FBYSxZIiwiZmlsZSI6InNjcmlwdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIENlbGxcclxue1xyXG4gICAgeDogbnVtYmVyO1xyXG4gICAgeTogbnVtYmVyO1xyXG4gICAgZWxlbWVudDogYW55O1xyXG4gICAgY29udGFpbnNPYmplY3Q6IGJvb2xlYW47XHJcblxyXG4gICAgY29uc3RydWN0b3IoeDogbnVtYmVyLCB5OiBudW1iZXIpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy54ID0geDtcclxuICAgICAgICB0aGlzLnkgPSB5O1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuY29udGFpbnNPYmplY3QgPSBmYWxzZTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgR3JpZFxyXG57XHJcbiAgICB3aWR0aDogbnVtYmVyO1xyXG4gICAgaGVpZ2h0OiBudW1iZXI7XHJcbiAgICBncmlkOiBhbnk7XHJcblxyXG4gICAgY29uc3RydWN0b3Iod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0O1xyXG4gICAgICAgIHRoaXMuZ3JpZCA9IHRoaXMuY3JlYXRlR3JpZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUdyaWQoKVxyXG4gICAge1xyXG4gICAgICAgIGxldCBpOiBudW1iZXI7XHJcbiAgICAgICAgbGV0IGo6IG51bWJlcjtcclxuICAgICAgICBsZXQgZ3JpZCA9IG5ldyBBcnJheSh0aGlzLmhlaWdodCk7XHJcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuaGVpZ2h0OyBpKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBsZXQgcm93OiBDZWxsW10gPSBuZXcgQXJyYXkodGhpcy53aWR0aCk7XHJcbiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB0aGlzLndpZHRoOyBqKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJvd1tqXSA9IG5ldyBDZWxsKGosIGkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGdyaWRbaV0gPSByb3c7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZ3JpZDtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgUGVyc29uXHJcbntcclxuICAgIGN1cnJlbnRYOiBudW1iZXI7XHJcbiAgICBjdXJyZW50WTogbnVtYmVyO1xyXG4gICAgY3VycmVudENlbGw6IENlbGw7XHJcbiAgICBob21lQ2VsbDogQ2VsbDtcclxuICAgIGdyaWQ6IEdyaWQ7XHJcbiAgICBlbGVtZW50OiBhbnk7XHJcblxyXG4gICAgY29uc3RydWN0b3IoZ3JpZDogR3JpZCxzdGFydFg6IG51bWJlciwgc3RhcnRZOiBudW1iZXIpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5ncmlkID0gZ3JpZDtcclxuICAgICAgICB0aGlzLmN1cnJlbnRYID0gc3RhcnRYIC0gMTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRZID0gc3RhcnRZIC0gMTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRDZWxsID0gZ3JpZC5ncmlkW3N0YXJ0WS0xXVtzdGFydFgtMV07XHJcbiAgICAgICAgdGhpcy5ob21lQ2VsbCA9IGdyaWQuZ3JpZFtzdGFydFktMV1bc3RhcnRYLTFdO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGZhbHNlO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBHYW1lXHJcbntcclxuICAgIHRpbWVQbGF5OiBudW1iZXI7XHJcbiAgICBjYW5QbGF5OiBib29sZWFuO1xyXG4gICAgc3RvcEZ1bmN0aW9uOiBhbnk7XHJcbiAgICBwZXJzb246IFBlcnNvbjtcclxuICAgIHZpZXc6IFZpZXc7XHJcbiAgICBtb2RlbDogTW9kZWw7XHJcbiAgICBjb3VudDogbnVtYmVyO1xyXG4gICAgaXNDb2xsZWN0ZWQ6IGJvb2xlYW47XHJcbiAgICBjb250aW51ZUdhbWU6IGJvb2xlYW47XHJcblxyXG4gICAgY29uc3RydWN0b3IodGltZVBsYXk6IG51bWJlciwgcGVyc29uOiBQZXJzb24sIHN0b3BGdW5jdGlvbjogYW55ID0gZmFsc2UsIHZpZXc6VmlldywgbW9kZWw6IE1vZGVsKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMudGltZVBsYXkgPSB0aW1lUGxheTtcclxuICAgICAgICB0aGlzLmNhblBsYXkgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnN0b3BGdW5jdGlvbiA9IHN0b3BGdW5jdGlvbjtcclxuICAgICAgICB0aGlzLnBlcnNvbiA9IHBlcnNvbjtcclxuICAgICAgICB0aGlzLnZpZXcgPSB2aWV3O1xyXG4gICAgICAgIHRoaXMubW9kZWwgPSBtb2RlbDtcclxuICAgICAgICB0aGlzLmNvdW50ID0gMDtcclxuICAgICAgICB0aGlzLmlzQ29sbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jb250aW51ZUdhbWUgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBzdGFydEdhbWUoKVxyXG4gICAge1xyXG4gICAgICAgIGxldCB0aGF0OiBHYW1lID0gdGhpcztcclxuICAgICAgICB0aGlzLmNhblBsYXkgPSB0cnVlO1xyXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHRoYXQuc3RvcEdhbWUodGhhdCk7XHJcbiAgICAgICAgfSwgdGhpcy50aW1lUGxheSk7XHJcblxyXG4gICAgICAgIGxldCBjb3VudGVyOiBudW1iZXIgPSB0aGlzLnRpbWVQbGF5LzEwMDtcclxuICAgICAgICBsZXQgcHJvZ3Jlc3NCYXI6IEhUTUxFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Byb2dyZXNzJyk/LnF1ZXJ5U2VsZWN0b3IoJ3Byb2dyZXNzJykgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgICAgZnVuY3Rpb24gcHJvZ3Jlc3NGaWxsKCkgXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjb3VudGVyLS07XHJcbiAgICAgICAgICAgIHByb2dyZXNzQmFyLnNldEF0dHJpYnV0ZSgndmFsdWUnLCBgJHtjb3VudGVyfWApO1xyXG4gICAgICAgICAgICBpZihjb3VudGVyIDw9IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdG9wIHRpbWVyJylcclxuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGltZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCB0aW1lciA9IHNldEludGVydmFsKHByb2dyZXNzRmlsbCwgMTAwKTtcclxuICAgIH1cclxuXHJcbiAgICBzdG9wR2FtZSh0aGF0OiBHYW1lKVxyXG4gICAge1xyXG4gICAgICAgIHRoYXQuY2FuUGxheSA9IGZhbHNlO1xyXG4gICAgICAgIGlmICh0aGF0LnN0b3BGdW5jdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoYXQuc3RvcEZ1bmN0aW9uKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBWaWV3XHJcbntcclxuICAgIHN0YXJ0KGdyaWQ6IEdyaWQsIHBlcnNvbjogUGVyc29uLCBnYW1lOiBHYW1lLCBvYmplY3RzOiBhbnkpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5kcmF3R3JpZChncmlkKTtcclxuICAgICAgICBwZXJzb24uZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwZXJzb24nKSBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgICBwZXJzb24uY3VycmVudENlbGwuZWxlbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9tZScpKTtcclxuICAgICAgICB0aGlzLnNldFBvc2l0aW9uUGVyc29uKHBlcnNvbiwgcGVyc29uLmN1cnJlbnRDZWxsKTtcclxuICAgICAgICB0aGlzLmRyYXdQcm9ncmVzc0JhcihnYW1lLnRpbWVQbGF5KTtcclxuICAgICAgICB0aGlzLmRyYXdPYmplY3RzKG9iamVjdHMpO1xyXG4gICAgICAgIGdhbWUuc3RhcnRHYW1lKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdmlld01lc3NhZ2UoKVxyXG4gICAge1xyXG4gICAgICAgIGxldCBtZXNzYWdlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tZXNzYWdlJykgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgICAgbWVzc2FnZUVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcclxuICAgIH1cclxuXHJcbiAgICBoaWRlTWVzc2FnZSgpXHJcbiAgICB7XHJcbiAgICAgICAgbGV0IG1lc3NhZ2VFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1lc3NhZ2UnKSBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgICBtZXNzYWdlRWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7XHJcbiAgICB9XHJcblxyXG4gICAgZHJhd09iamVjdHMob2JqZWN0czogYW55KVxyXG4gICAge1xyXG4gICAgICAgIG9iamVjdHMuZm9yRWFjaCgob2JqZWN0OiBDZWxsKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBjYXJyb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxyXG4gICAgICAgICAgICBjYXJyb3QuY2xhc3NMaXN0LmFkZCgnY2Fycm90Jyk7XHJcbiAgICAgICAgICAgIG9iamVjdC5lbGVtZW50LmFwcGVuZENoaWxkKGNhcnJvdClcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIGNsZWFuaW5nQ2VsbChvYmplY3RzOiBhbnkpXHJcbiAgICB7XHJcbiAgICAgICAgb2JqZWN0cy5mb3JFYWNoKChvYmplY3Q6IENlbGwpID0+IHtcclxuICAgICAgICAgICAgb2JqZWN0LmVsZW1lbnQuaW5uZXJIVE1MID0gJyc7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBjb250aW51ZUdhbWUocGVyc29uOiBQZXJzb24sIGdhbWU6IEdhbWUsIG9iamVjdHM6IGFueSlcclxuICAgIHtcclxuICAgICAgICB0aGlzLnNldFBvc2l0aW9uUGVyc29uKHBlcnNvbiwgcGVyc29uLmhvbWVDZWxsKTtcclxuICAgICAgICB0aGlzLmRyYXdPYmplY3RzKG9iamVjdHMpO1xyXG4gICAgICAgIGdhbWUuc3RhcnRHYW1lKCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2NvbnRpbnVlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0UG9zaXRpb25QZXJzb24ocGVyc29uOiBQZXJzb24sIGNlbGw6IENlbGwpXHJcbiAgICB7XHJcbiAgICAgICAgaWYgKGNlbGwuY29udGFpbnNPYmplY3QpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjZWxsLmVsZW1lbnQuaW5uZXJIVE1MID0gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNlbGwuZWxlbWVudC5hcHBlbmRDaGlsZChwZXJzb24uZWxlbWVudCk7XHJcbiAgICAgICAgcGVyc29uLmN1cnJlbnRYID0gY2VsbC54O1xyXG4gICAgICAgIHBlcnNvbi5jdXJyZW50WSA9IGNlbGwueTtcclxuICAgICAgICBwZXJzb24uY3VycmVudENlbGwgPSBjZWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZnJlc2hDb3VudChjb3VudDogbnVtYmVyKVxyXG4gICAge1xyXG4gICAgICAgIGxldCBjb3VudGVyOiBIVE1MRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb3VudGVyJykgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgICAgY291bnRlci5pbm5lckhUTUwgPSBgJHtjb3VudH1gO1xyXG4gICAgfVxyXG5cclxuICAgIGRyYXdQcm9ncmVzc0Jhcih0aW1lUGxheTogbnVtYmVyKVxyXG4gICAge1xyXG4gICAgICAgIGxldCBwcm9ncmVzc0JhckNvbnRhaW5lcjogSFRNTEVsZW1lbnR8IG51bGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3MnKSBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgICBsZXQgcHJvZ3Jlc3NCYXI6IEhUTUxFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncHJvZ3Jlc3MnKTtcclxuICAgICAgICBwcm9ncmVzc0Jhci5zZXRBdHRyaWJ1dGUoJ21heCcsIGAke3RpbWVQbGF5LzEwMH1gKTtcclxuICAgICAgICBwcm9ncmVzc0Jhci5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgJzAnKTtcclxuICAgICAgICBwcm9ncmVzc0JhckNvbnRhaW5lci5hcHBlbmRDaGlsZChwcm9ncmVzc0Jhcik7XHJcbiAgICB9XHJcblxyXG4gICAgZHJhd0dyaWQoZ3JpZDogR3JpZClcclxuICAgIHtcclxuICAgICAgICBsZXQgZ3JpZENvbnRhaW5lcjogSFRNTEVsZW1lbnQgfCBudWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dyaWQnKSBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgICBsZXQgaTogbnVtYmVyO1xyXG4gICAgICAgIGxldCBqOiBudW1iZXI7XHJcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGdyaWQuaGVpZ2h0OyBpKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBsZXQgZGl2OiBIVE1MRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBkaXYuY2xhc3NMaXN0LmFkZCgncm93Jyk7XHJcbiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBncmlkLndpZHRoOyBqKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGxldCBjZWxsOkhUTUxFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ2NlbGwnKTtcclxuICAgICAgICAgICAgICAgIGdyaWQuZ3JpZFtpXVtqXS5lbGVtZW50ID0gY2VsbDtcclxuICAgICAgICAgICAgICAgIGdyaWQuZ3JpZFtpXVtqXS5odG1sWCA9IGNlbGwuc3R5bGUubGVmdCArICdweCc7XHJcbiAgICAgICAgICAgICAgICBncmlkLmdyaWRbaV1bal0uaHRtbFkgPSBjZWxsLnN0eWxlLnRvcCArICdweCc7XHJcbiAgICAgICAgICAgICAgICBkaXY/LmFwcGVuZENoaWxkKGNlbGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGdyaWRDb250YWluZXI/LmFwcGVuZENoaWxkKGRpdik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBNb2RlbFxyXG57XHJcbiAgICB2aWV3OiBWaWV3O1xyXG4gICAgZ3JpZDogR3JpZDtcclxuICAgIHBlcnNvbjogUGVyc29uO1xyXG4gICAgZ2FtZTogR2FtZTtcclxuICAgIGNvdW50OiBudW1iZXI7XHJcbiAgICBsYXN0Um91bmRDb3VudDogbnVtYmVyO1xyXG4gICAgb2JqZWN0czogYW55O1xyXG4gICAgaXNDb2xsZWN0ZWQ6IGJvb2xlYW47XHJcbiAgICBjb250aW51ZUdhbWU6IGJvb2xlYW47XHJcblxyXG4gICAgY29uc3RydWN0b3IodmlldzogVmlldywgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIHRpbWVSb3VuZDogbnVtYmVyKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMudmlldyA9IHZpZXc7XHJcbiAgICAgICAgdGhpcy5ncmlkID0gbmV3IEdyaWQod2lkdGgsIGhlaWdodCk7XHJcbiAgICAgICAgdGhpcy5wZXJzb24gPSBuZXcgUGVyc29uKHRoaXMuZ3JpZCwgMywgNSk7XHJcbiAgICAgICAgdGhpcy5nYW1lID0gbmV3IEdhbWUoKHRpbWVSb3VuZCoxMDAwKS8yLCB0aGlzLnBlcnNvbiwgdGhpcy5zdG9wR2FtZSwgdGhpcy52aWV3LCB0aGlzKTtcclxuICAgICAgICB0aGlzLmNvdW50ID0gMDtcclxuICAgICAgICB0aGlzLmxhc3RSb3VuZENvdW50ID0gMDtcclxuICAgICAgICB0aGlzLmlzQ29sbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jb250aW51ZUdhbWUgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBzdGFydCgpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5vYmplY3RzID0gdGhpcy5jYWxjdWxhdGVQb3NpdGlvbk9iamVjdHMoKTtcclxuICAgICAgICB0aGlzLnZpZXcuc3RhcnQodGhpcy5ncmlkLCB0aGlzLnBlcnNvbiwgdGhpcy5nYW1lLCB0aGlzLm9iamVjdHMpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0b3BHYW1lKClcclxuICAgIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnc3RvcCBnYW1lJyk7XHJcbiAgICAgICAgaWYgKCh0aGlzLnBlcnNvbi5jdXJyZW50Q2VsbCAhPSB0aGlzLnBlcnNvbi5ob21lQ2VsbCkgfHwgKHRoaXMuaXNDb2xsZWN0ZWQgPT0gZmFsc2UpKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2xvc2UnKVxyXG4gICAgICAgICAgICB0aGlzLmNvbnRpbnVlR2FtZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLmNvdW50ID0gMDtcclxuICAgICAgICAgICAgdGhpcy52aWV3LnJlZnJlc2hDb3VudCh0aGlzLmNvdW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5jb250aW51ZUdhbWUgPSB0cnVlO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnY29vbCcpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudmlldy52aWV3TWVzc2FnZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNhbGN1bGF0ZVBvc2l0aW9uT2JqZWN0cygpXHJcbiAgICB7XHJcbiAgICAgICAgbGV0IG1pbjogbnVtYmVyID0gMjtcclxuICAgICAgICBsZXQgbWF4OiBudW1iZXIgPSA1O1xyXG4gICAgICAgIGxldCByYW5kb21Db3VudCA9IHRoaXMucmFuZG9tSW50KG1pbiwgbWF4KTtcclxuICAgICAgICBsZXQgaTogbnVtYmVyO1xyXG4gICAgICAgIGxldCBvYmplY3RzID0gbmV3IEFycmF5KHJhbmRvbUNvdW50KTtcclxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcmFuZG9tQ291bnQ7IGkrKylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGxldCB5OiBudW1iZXIgPSB0aGlzLnJhbmRvbUludCgwLCB0aGlzLmdyaWQuaGVpZ2h0IC0gMSk7XHJcbiAgICAgICAgICAgIGxldCB4OiBudW1iZXIgPSB0aGlzLnJhbmRvbUludCgwLCB0aGlzLmdyaWQud2lkdGggLSAxKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMucGVyc29uLmhvbWVDZWxsID09IHRoaXMuZ3JpZC5ncmlkW3ldW3hdKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpLS07XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmdyaWQuZ3JpZFt5XVt4XS5jb250YWluc09iamVjdCA9IHRydWU7XHJcbiAgICAgICAgICAgIG9iamVjdHNbaV0gPSB0aGlzLmdyaWQuZ3JpZFt5XVt4XTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBvYmplY3RzO1xyXG4gICAgfVxyXG5cclxuICAgIHJhbmRvbUludChtaW46IG51bWJlciwgbWF4OiBudW1iZXIpXHJcbiAgICB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47XHJcbiAgICB9XHJcblxyXG4gICAgY2hlY2tDb250YWlucyhjZWxsOiBDZWxsKVxyXG4gICAge1xyXG4gICAgICAgIGlmIChjZWxsLmNvbnRhaW5zT2JqZWN0KVxyXG4gICAgICAgIHsgICBcclxuICAgICAgICAgICAgdGhpcy5nYW1lLmlzQ29sbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5jb3VudCArPSAxO1xyXG4gICAgICAgICAgICB0aGlzLnZpZXcucmVmcmVzaENvdW50KHRoaXMuY291bnQpO1xyXG4gICAgICAgICAgICBjZWxsLmNvbnRhaW5zT2JqZWN0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGxldCBpOiBudW1iZXI7XHJcbiAgICAgICAgICAgIGxldCBpbmRleDogbnVtYmVyO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5vYmplY3RzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2VsbCA9PSB0aGlzLm9iamVjdHNbaV0pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsZWFuaW5nQ2VsbCgpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5vYmplY3RzLmZvckVhY2goKG9iamVjdDogQ2VsbCkgPT4ge1xyXG4gICAgICAgICAgICBvYmplY3QuY29udGFpbnNPYmplY3QgPSBmYWxzZTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBkZWZpbml0aW9uS2V5KGNvZGU6IHN0cmluZylcclxuICAgIHtcclxuICAgICAgICBpZiAodGhpcy5nYW1lLmNhblBsYXkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKGNvZGUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0tleVcnOiBcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKHRoaXMucGVyc29uLmN1cnJlbnRZIC0gMSkgPj0gMClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjZWxsOiBDZWxsID0gdGhpcy5ncmlkLmdyaWRbdGhpcy5wZXJzb24uY3VycmVudFktMV1bdGhpcy5wZXJzb24uY3VycmVudFhdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZpZXcuc2V0UG9zaXRpb25QZXJzb24odGhpcy5wZXJzb24sIGNlbGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrQ29udGFpbnMoY2VsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2FzZSAnS2V5Uyc6IFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgodGhpcy5wZXJzb24uY3VycmVudFkgKyAxKSA8PSAodGhpcy5ncmlkLmhlaWdodCAtIDEpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNlbGw6IENlbGwgPSB0aGlzLmdyaWQuZ3JpZFt0aGlzLnBlcnNvbi5jdXJyZW50WSsxXVt0aGlzLnBlcnNvbi5jdXJyZW50WF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlldy5zZXRQb3NpdGlvblBlcnNvbih0aGlzLnBlcnNvbiwgY2VsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tDb250YWlucyhjZWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXNlICdLZXlBJzogXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCh0aGlzLnBlcnNvbi5jdXJyZW50WCAtIDEpID49IDApXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2VsbDogQ2VsbCA9IHRoaXMuZ3JpZC5ncmlkW3RoaXMucGVyc29uLmN1cnJlbnRZXVt0aGlzLnBlcnNvbi5jdXJyZW50WC0xXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3LnNldFBvc2l0aW9uUGVyc29uKHRoaXMucGVyc29uLCBjZWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja0NvbnRhaW5zKGNlbGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0tleUQnOiBcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKHRoaXMucGVyc29uLmN1cnJlbnRYICsgMSkgPD0gKHRoaXMuZ3JpZC53aWR0aCAtIDEpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNlbGw6IENlbGwgPSB0aGlzLmdyaWQuZ3JpZFt0aGlzLnBlcnNvbi5jdXJyZW50WV1bdGhpcy5wZXJzb24uY3VycmVudFgrMV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlldy5zZXRQb3NpdGlvblBlcnNvbih0aGlzLnBlcnNvbiwgY2VsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tDb250YWlucyhjZWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKGNvZGUgPT0gJ0VudGVyJylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3LmhpZGVNZXNzYWdlKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdhbWUuaXNDb2xsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5nYW1lLmNvbnRpbnVlR2FtZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvdW50ID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9iamVjdHMubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFuaW5nQ2VsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmlldy5jbGVhbmluZ0NlbGwodGhpcy5vYmplY3RzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMub2JqZWN0cyA9IHRoaXMuY2FsY3VsYXRlUG9zaXRpb25PYmplY3RzKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXcuY29udGludWVHYW1lKHRoaXMucGVyc29uLCB0aGlzLmdhbWUsIHRoaXMub2JqZWN0cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIENvbnRyb2xsZXJcclxue1xyXG4gICAgbW9kZWw6IE1vZGVsO1xyXG4gICAgXHJcbiAgICBjb25zdHJ1Y3Rvcihtb2RlbDogTW9kZWwpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXJ0KClcclxuICAgIHtcclxuICAgICAgICB0aGlzLm1vZGVsLnN0YXJ0KCk7XHJcbiAgICAgICAgdGhpcy5hdWRpdGlvbkV2ZW50KCk7XHJcbiAgICB9XHJcblxyXG4gICAgYXVkaXRpb25FdmVudCgpXHJcbiAgICB7XHJcbiAgICAgICAgZG9jdW1lbnQub25rZXlkb3duID0gKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubW9kZWwuZGVmaW5pdGlvbktleShldmVudC5jb2RlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxubGV0IHN0YXJ0OiBib29sZWFuID0gZmFsc2U7XHJcblxyXG5sZXQgbWVzc2FnZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc3RhcnQtbWVzc2FnZScpIGFzIEhUTUxFbGVtZW50O1xyXG5tZXNzYWdlRWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnO1xyXG5cclxubGV0IG1haW5FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1haW4nKSBhcyBIVE1MRWxlbWVudDtcclxubWFpbkVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xyXG5cclxuZG9jdW1lbnQub25rZXlkb3duID0gKGV2ZW50KSA9PiB7XHJcbiAgICBpZiAoIXN0YXJ0KVxyXG4gICAge1xyXG4gICAgICAgIGlmIChldmVudC5jb2RlID09ICdFbnRlcicpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBsZXQgd2lkdGggPSBwcm9tcHQoJ9CS0LLQtdC00LjRgtC1INGI0LjRgNC40L3RgyDQv9C+0LvRjyA+PSA1JywgJycpO1xyXG4gICAgICAgICAgICB3aGlsZSAoTnVtYmVyKHdpZHRoKSA8IDUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHdpZHRoID0gcHJvbXB0KCfQktCy0LXQtNC40YLQtSDRiNC40YDQuNC90YMg0L/QvtC70Y8gPj0gNScsICcnKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBoZWlnaHQgPSBwcm9tcHQoJ9CS0LLQtdC00LjRgtC1INCy0YvRgdC+0YLRgyDQv9C+0LvRjyA+PSA1JywgJycpO1xyXG4gICAgICAgICAgICB3aGlsZSAoTnVtYmVyKGhlaWdodCkgPCA1KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSBwcm9tcHQoJ9CS0LLQtdC00LjRgtC1INCy0YvRgdC+0YLRgyDQv9C+0LvRjyA+PSA1JywgJycpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IHRpbWVSb3VuZCA9IHByb21wdCgn0JLQstC10LTQuNGC0LUg0LLRgNC10LzRjyDRgNCw0YPQvdC00LAgPj0gNSDRgdC10LrRg9C90LQnLCAnJyk7XHJcbiAgICAgICAgICAgIHdoaWxlIChOdW1iZXIodGltZVJvdW5kKSA8IDUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRpbWVSb3VuZCA9IHByb21wdCgn0JLQstC10LTQuNGC0LUg0LLRgNC10LzRjyDRgNCw0YPQvdC00LAgPj0gNScsICcnKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG1haW5FbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7XHJcbiAgICAgICAgICAgIGNvbnN0IHZpZXc6IFZpZXcgPSBuZXcgVmlldygpO1xyXG4gICAgICAgICAgICBjb25zdCBtb2RlbDogTW9kZWwgPSBuZXcgTW9kZWwodmlldywgTnVtYmVyKHdpZHRoKSwgTnVtYmVyKGhlaWdodCksIE51bWJlcih0aW1lUm91bmQpKTtcclxuICAgICAgICAgICAgY29uc3QgY29udHJvbGxlcjogQ29udHJvbGxlciA9IG5ldyBDb250cm9sbGVyKG1vZGVsKTtcclxuICAgICAgICAgICAgY29udHJvbGxlci5zdGFydCgpO1xyXG4gICAgICAgICAgICBtZXNzYWdlRWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5cclxuXHJcblxyXG4iXSwic291cmNlUm9vdCI6IiJ9